#!/bin/sh

dir=`dirname $0`

SITE_DIR=$dir/../site

$dir/install_adt
$dir/make_selfsigned_cert
$dir/install_jruby

# install jruby dependencies
$dir/bundle

echo "Preparing to package app"

output_file='CompassAppInstaller'
if [ $1 = 'dmg' ] ; then 
  output_file=$output_file.dmg
fi

if [ $1 = 'exe' ] ; then
  output_file=$output_file.exe
fi

echo "Moving into $SITE_DIR"
pushd $SITE_DIR > /dev/null
cmd="adt -package -storetype pkcs12 -keystore ../cert.pfx -target native ../$output_file production.xml ." 
echo "Running command: $cmd"
time $cmd
popd > /dev/null